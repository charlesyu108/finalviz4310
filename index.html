<!DOCTYPE html>
<html>

<head>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <link href="styles.css" rel="stylesheet"></link>
  <!-- mapbox -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css' rel='stylesheet' />
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />
</head>

<body>
  <h1>INFO 4310 Final Project</h1>
  <svg id="bubble-svg" width=800 height=600></svg>

  <div id="map" style="height:650px;width:500px;display:block"></div>
</body>

<script>
  //Loading in Data
  d3.queue()
    .defer(d3.csv, "profiles.csv")
    .defer(d3.json, "okcupid.json")
    .await(makeViz);

  function makeViz(err, data, jsondata) {
    console.log("Data Loaded!", data.length);

    var sampleData = {
      "children": [{
          "text": "hello",
          "count": 20
        },
        {
          "text": "artsy",
          "count": 200
        },
        {
          "text": "adventurous",
          "count": 145
        },
        {
          "text": "love",
          "count": 305
        },
        {
          "text": "harry potter",
          "count": 30
        },
        {
          "text": "game of thrones",
          "count": 13
        },
        {
          "text": "san francisco",
          "count": 155
        },
        {
          "text": "fun",
          "count": 300
        },
        {
          "text": "amp",
          "count": 70
        },

      ]
    }
    var essayq = "essay6";

    var gender = "f";
    // var essayq = "essay0";
    var jData = jsondata.filter( d => (d.gender == gender && d.essay == essayq))[0];
    // jData.top_word = jData.top_word.slice(100, 200);
    console.log(jData);
    sampleData1 = {"children": jData.top_word.map(function (d){ return  {"text": d[0], "count": d[1], "gender": gender} }) };
    femaletext = sampleData1.children.map(d => d.text);

    var gender = "m";
    // var essayq = "essay0";
    var jData = jsondata.filter( d => (d.gender == gender && d.essay == essayq))[0];
    // jData.top_word = jData.top_word.slice(100, 200);
    console.log(jData);
    sampleData2 = {"children": jData.top_word.map(function (d){ return  {"text": d[0], "count": d[1], "gender": gender} }) };
    maletext = sampleData2.children.map(d => d.text);

    sampleData =  {"children": sampleData1.children.concat(sampleData2.children)};

    console.log(sampleData);
    console.log("shared", maletext.filter(d => femaletext.indexOf(d) > -1));
    console.log("male-only", maletext.filter(d => femaletext.indexOf(d) == -1));
    console.log("female-only", femaletext.filter(d => maletext.indexOf(d) == -1));




    //NOTE!: The "children" field is very important to include!

    var bubble_svg = d3.select("#bubble-svg"),
      width = +bubble_svg.attr("width"),
      height = +bubble_svg.attr("height");

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var bubble = d3.pack(sampleData)
      .size([width, height])
      .padding(1.5);

    var bubble_tooltip = d3.select("body").append("div")
      .style("position", "absolute")
      .html("test");

    var nodes = d3.hierarchy(sampleData)
      .sum(d => d.count);

    var node = bubble_svg.selectAll(".node")
      .data(bubble(nodes).descendants())
      .enter()
      .filter(d => !d.children)
      .append("g")
      .attr("class", "node")
      .attr("transform", d => "translate(" + d.x + "," + d.y + ")");

    node.append("title")
      .text(d => d.data.text);

    node.append("circle")
      .attr("r", d => d.r)
      .style("fill", (d, i) => (d.data.gender =="f" ? "red": "blue"));

    node.append("text")
      .attr("dy", ".2em")
      .attr("font-family", "sans-serif")
      .attr("text-anchor", "middle")
      .attr("font-size", (d => d.r / 5))
      .attr("fill", "white")
      .text(d => d.data.text)

    // Overlayed, transparent circle
    node.append("circle")
      .attr("class", "overlay")
      .attr("r", d => d.r)
      .style("opacity", 0)
      .on("mouseover", showToolTip)
      .on("mousemove", moveToolTip)
      .on("mouseout", hideToolTip);

    function moveToolTip(){
      bubble_tooltip
      .style("top", 12 + d3.event.pageY +"px")
      .style("left", 12 + d3.event.pageX+"px");
    }

    function showToolTip(){
      bubble_tooltip
      .style("display", "inline")
    }

    function hideToolTip(){
      bubble_tooltip
      .style("display", "none");
    }
  }

  //Bubble viz credit: https://bl.ocks.org/alokkshukla/3d6be4be0ef9f6977ec6718b2916d168
</script>


</html>
